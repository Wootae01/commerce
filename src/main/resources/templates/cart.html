<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>상품 관리</title>
</head>
<body>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>장바구니</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a2e0b4b8d6.js" crossorigin="anonymous"></script>
    <style>
        .big-checkbox {
            transform: scale(1.5);
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-light">
<div th:replace="~{fragments/header :: siteHeader}"></div>
<div class="container py-5">
    <h2 class="mb-4 fw-bold text-center">🛒 장바구니</h2>

    <div th:if="${#lists.isEmpty(cartProducts)}" class="alert alert-info text-center">
        장바구니에 담긴 상품이 없습니다.
    </div>

    <!-- 상품 테이블 -->
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                <tr>
                    <th>선택</th>
                    <th>이미지</th>
                    <th>상품명</th>
                    <th>가격</th>
                    <th>수량</th>
                    <th>삭제</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="product : ${cartProducts}">
                    <td th:class="d-none" th:text="${product.id}"></td>
                    <td>
                        <div class="form-check justify-content-center">
                            <form th:action="@{'/cart/select/'+${product.id}}" method="post" class="d-inline">
                                <input type="checkbox"
                                       name="checked"
                                       class="form-check-input big-checkbox"
                                       th:checked="${product.checked}"
                                       onchange="this.form.submit()"
                                >
                            </form>

                        </div>
                    </td>
                    <td>
                        <img th:src="@{${product.mainImageUrl}}" alt="상품 대표 이미지"
                             style="width:60px; height:60px; object-fit:cover;" class="rounded">
                    </td>
                    <td th:text="${product.name}"></td>
                    <td th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'"></td>
                    <td>
                        <form th:action="@{'/cart/edit/' + ${product.id}}" method="post" class="d-inline">
                            <select name="quantity" class="form-select form-select-sm"
                                    style="width: 80px;"
                                    onchange="this.form.submit()">
                                <option th:each="i : ${#numbers.sequence(1, 10)}"
                                        th:value="${i}"
                                        th:selected="${product.quantity == i}"
                                        th:text="${i}">
                                </option>
                            </select>
                        </form>
                    </td>
                    <td>
                        <form th:action="@{'/cart/delete/' + ${product.id}}"
                              method="post" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-danger"
                                    onclick="return confirm('정말 삭제하시겠습니까?')">
                                삭제
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="p-4">
                <div>
                    <h5 class="fw-bold">
                        총 금액:
                        <span class="text-danger" th:text="${#numbers.formatInteger(totalPrice, 3, 'COMMA')} + '원'"></span>
                    </h5>
                </div>
                <form method="get" th:action="@{/orders/cart}">
                    <button class="my-2 btn btn-primary" >주문 하기</button>
                </form>

            </div>

        </div>
    </div>

</div>

</body>
</html>

</body>
</html>